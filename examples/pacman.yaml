name: Pacman/Yay Commands
description: Arch Linux package management

commands:
  # Update info
  - name: last updated
    command: sh
    args: ["-c", "grep -E 'starting full system upgrade|upgraded' /var/log/pacman.log | tail -20"]
    description: Show last system update time and upgraded packages

  - name: update date
    command: sh
    args: ["-c", "stat -c '%y' /var/lib/pacman/sync/*.db | head -1"]
    description: When package databases were last synced

  # List packages
  - name: list installed
    command: pacman
    args: ["-Q"]
    description: List all installed packages

  - name: list explicit
    command: pacman
    args: ["-Qe"]
    description: List explicitly installed packages (not dependencies)

  - name: list foreign
    command: pacman
    args: ["-Qm"]
    description: List foreign packages (AUR, manual installs)

  - name: list orphans
    command: pacman
    args: ["-Qtdq"]
    description: List orphan packages (unused dependencies)

  - name: list by size
    command: sh
    args: ["-c", "pacman -Qi | awk '/^Name/{name=$3} /^Installed Size/{print $4$5, name}' | sort -hr | head -30"]
    description: Top 30 largest installed packages

  - name: list recent
    command: sh
    args: ["-c", "expac --timefmt='%Y-%m-%d %T' '%l\\t%n' | sort -r | head -20"]
    description: Recently installed/updated packages

  # Check for updates
  - name: check updates
    command: checkupdates
    description: Check for available updates (safe, no sudo)

  - name: check updates aur
    command: yay
    args: ["-Qua"]
    description: Check for AUR updates

  - name: count outdated
    command: sh
    args: ["-c", "checkupdates 2>/dev/null | wc -l"]
    description: Count number of available updates

  # Package info
  - name: pkg info
    command: pacman
    args: ["-Qi", "{{package}}"]
    description: Show detailed info about installed package
    placeholders:
      package:
        source: "pacman -Qq"

  - name: pkg files
    command: pacman
    args: ["-Ql", "{{package}}"]
    description: List files owned by package
    placeholders:
      package:
        source: "pacman -Qq"

  - name: pkg owns
    command: pacman
    args: ["-Qo", "{{file}}"]
    description: Find which package owns a file

  - name: pkg search
    command: pacman
    args: ["-Ss", "{{query}}"]
    description: Search for package in repos

  - name: pkg search aur
    command: yay
    args: ["-Ss", "{{query}}"]
    description: Search for package in repos + AUR

  # Install/Remove
  - name: install pkg
    command: sudo
    args: ["pacman", "-S", "{{package}}"]
    description: Install package from repos

  - name: install aur
    command: yay
    args: ["-S", "{{package}}"]
    description: Install package (repos + AUR)

  - name: remove pkg
    command: sudo
    args: ["pacman", "-Rs", "{{package}}"]
    description: Remove package and unused dependencies
    placeholders:
      package:
        source: "pacman -Qq"

  # System update
  - name: update system
    command: sudo
    args: ["pacman", "-Syu"]
    description: Full system update

  - name: update all
    command: yay
    args: ["-Syu"]
    description: Full system update including AUR

  # Maintenance
  - name: clean cache
    command: sudo
    args: ["pacman", "-Sc"]
    description: Remove old package cache

  - name: clean cache all
    command: sudo
    args: ["pacman", "-Scc"]
    description: Remove all package cache

  - name: remove orphans
    command: sh
    args: ["-c", "pacman -Qtdq | sudo pacman -Rns -"]
    description: Remove all orphan packages

  - name: cache size
    command: du
    args: ["-sh", "/var/cache/pacman/pkg"]
    description: Show package cache size

  # Database
  - name: sync db
    command: sudo
    args: ["pacman", "-Sy"]
    description: Sync package database only

  - name: verify pkgs
    command: pacman
    args: ["-Qkk"]
    description: Verify all installed packages (check file integrity)
